# 联调配置

## 后端

1. 走网关的情况下，无需配置

2. 使用服务器的域名请求接口，需要配置nginx

   1. 修改配置文件：/usr/local/nginx/conf/nginx.conf

      ```json
      server {  
          listen       80;
          listen       443 ssl;
          server_name test-kailing.zhiyimall.com;
          charset utf-8;
          ssl_certificate   ../cert/zhiyimall.com.pem;
          ssl_certificate_key  ../cert/zhiyimall.com.key;
          ssl_session_timeout 5m;
          ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
          ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
          ssl_prefer_server_ciphers on;
          large_client_header_buffers 4 16k;
          client_max_body_size 300m;
          client_body_buffer_size 128k;
          proxy_connect_timeout 600;
          proxy_read_timeout 600;
          proxy_send_timeout 600;
          proxy_buffer_size 64k;
          proxy_buffers   4 32k;
          proxy_busy_buffers_size 64k;
          proxy_temp_file_write_size 64k;
      
          location / {  
              root   /usr/local/nginx/html;  
              try_files $uri $uri/ /index.html;  
              index  index.html index.htm;  
          }  
      
          location /prod-api/profile/ {  
              alias /home/ruoyi/uploadPath/;  
          } 
      
      	location /lqadapter {
          proxy_pass http://localhost:9057;  # 确保这里的端口与你的 Spring Boot 应用端口一致
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
      	}
      }
      ```

      ```shell
      nginx  -s  reload
      nginx  -t
      nginx  -s  stop
      ```

3. 参考：

   1. https://blog.51cto.com/u_16099240/13520214
   2. https://blog.csdn.net/qq_64392336/article/details/148698810
   3. https://blog.csdn.net/SOS_suyan/article/details/145430462

## 网关

1. 提供域名的地址（test-kailing.zhiyimall.com），配置网关路由（网关/kailing/接口地址）
2. 提供服务器IP地址和服务端口（114.55.62.244:9057），配置内网dns解析和slb代理。
3. 请求转发的流程：
   1. 网关路由配置，会把https://test-yunfu-gateway.zhiyimall.com/kailing/lqadapter/quota/query这个请求解析为https://test-kailing.zhiyimall.com/lqadapter/quota/query，
   2. 然后内网dns解析，会把地址解析为http://114.55.62.244:9057/lqadapter/quota/query


## 前端

1. 资源管理：菜单页面需要配置资源
2. 产品模块设置：配置产品和菜单，以及资源的关系
3. 校验token接口管理：接口权限配置。
   1. 模块名称就是网关路由配置的名称。（kailing）
   2. 接口路径是后端项目部署后访问的地址。（ /lqadapter/quota/query）

## Apifox

1. Apifox中配置接口

2. Cursor通过MCP使用Apifox项目中API

   1. 安装 [Node.js](https://nodejs.org/en) 环境（版本 ≥ 18，推荐使用最新的 LTS 版本）

   2. 获取 APIFOX_ACCESS_TOKEN": "APS-Xje6LxftgLvxjKGjHy7nZAjCdQtrjaZ1"

   3. 获取 Apifox 项目 ID

   4. 配置文件：

      ```json
      {
        "mcpServers": {
          "自动开具发票 - API 文档": {
            "command": "cmd",
            "args": [
              "/c",
              "npx",
              "-y",
              "apifox-mcp-server@latest",
              "--project-id=7067547"
            ],
            "env": {
              "APIFOX_ACCESS_TOKEN": "APS-Xje6LxftgLvxjKGjHy7nZAjCdQtrjaZ1"
            }
          }
        }
      }
      ```

   5. 验证 MCP 连接：Cursor中询问"请通过 MCP 获取 API 文档，并告诉我项目中有几个接口"，如果 AI 能够返回你 Apifox 项目中的 API 信息，说明连接成功。

3. Cursor开启MCP报错：

   1. 原因：使用 `npx -y apifox-mcp-server@latest` 命令安装第三方包时报错 

      C:\Users\lonch\AppData\Local\npm-cache\_npx\cd91540867942c9c\node_modules\apifox-mcp-server\lib\index.js:36

      SyntaxError: Unexpected end of input
          at wrapSafe (node:internal/modules/cjs/loader:1691:18)
          at Module._compile (node:internal/modules/cjs/loader:1734:20)
          at Object..js (node:internal/modules/cjs/loader:1893:10)
          at Module.load (node:internal/modules/cjs/loader:1480:32)
          at Module._load (node:internal/modules/cjs/loader:1299:12)
          at TracingChannel.traceSync (node:diagnostics_channel:328:14)
          at wrapModuleLoad (node:internal/modules/cjs/loader:244:24)
          at Module.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:154:5)
          at node:internal/main/run_main_module:33:47

   2. 解决方案：

      ```shell
      # ‌全局安装后使用
      npm install -g apifox-mcp-server@latest
      # 文件安装路径
      npm list -g
      # 运行服务
      apifox-mcp-server --project-id=7067547 --token="APS-Xje6LxftgLvxjKGjHy7nZAjCdQtrjaZ1"
      ```

   3. 重新配置cursor的MCP

      ```json
      {
        "mcpServers": {
          "自动开具发票 - API 文档": {
            "command": "cmd",
            "args": ["/c", "apifox-mcp-server", "--project-id=7067547","--token=APS-Xje6LxftgLvxjKGjHy7nZAjCdQtrjaZ1"],
            "env": {
              "APIFOX_ACCESS_TOKEN": "APS-Xje6LxftgLvxjKGjHy7nZAjCdQtrjaZ1"
            }
          }
        }
      }
      ```

# 前端API

- `src/api/modules/invoice.js` API 模块：
  - 发票开具前置处理页面：/digitalInvoice/init（初始化），
  - 
  - /taxpayer/sync（同步单个纳税人数据），/taxCatalog/sync（从乐企平台全量同步税收分类编码信息），/taxRate/sync（从乐企平台同步税率信息）
  - 发票开具列表：/digitalInvoice/list（分页查询上传成功的发票信息），/digitalInvoice/add（添加发票并创建上传任务），/digitalInvoice/executeUpload（执行发票上传任务)
  - 发票下载列表：
  - 发票汇总确认信息列表：
  - 发票额度操作记录：/quota/list（分页查询），/quota
- 页面调用对接：
  - 发票列表使用 `/digitalInvoice/list`，上传/下载管理调用 executeUpload、apply、executePending；
  - 纳税人列表使用 `/taxpayer/list`，同步调用 `/taxpayer/sync`；
  - 税率列表使用 `/taxRate/list`，同步调用 `/taxRate/sync`；
  - 税收分类编码使用 `/taxCatalog/list`、`/taxCatalog/sync`、`/taxCatalog/queryByCode`；

# 后端Controller完整接口清单

## 接口清单（7个Controller）

### 1. 数电发票管理（DigitalInvoiceController）
**路径**: `/digitalInvoice`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 添加发票并创建上传任务 | POST /add | DigitalInvoiceAddParam | DigitalInvoiceDto | 必填：@Valid |
| 执行发票上传任务 | POST /executeUpload | 无 | List<String> | 执行待上传任务 |
| 查询发票上传结果 | POST /queryUploadResult | sllsh(String, @NotBlank) | DigitalInvoiceUploadResultDto | 受理流水号 |
| 申请批量下载发票 | POST /apply | InvoiceDownloadApplyParam | InvoiceDownloadResultDto | 必填：@Valid |
| 执行待处理的下载任务 | POST /executePending | 无 | Integer | 执行下载任务数 |
| 增幅查询上传成功的发票信息 | POST /list | DigitalInvoiceQueryParam | Page<DigitalInvoiceQueryDto> | 分页查询 |

**前端页面**:
- **开票向导页面** (`/invoice/wizard`): 使用 Step1-4 向导（基本信息→明细→预赋码→提交），调用 `/add` 接口
- **发票列表页面** (`/invoice/list`): 使用 `/list` 接口，支持查询条件、分页、查看详情、下载
- **任务管理页面** (`/invoice/tasks`): 使用 `/executeUpload`、`/queryUploadResult`、`/executePending` 接口
- **下载管理页面** (`/invoice/downloads`): 使用 `/apply`、`/executePending` 接口

### 2. 纳税人管理（TaxpayerController）
**路径**: `/taxpayer`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 分页查询纳税人列表 | POST /list | TaxpayerQueryParam | Page<TaxpayerDto> | 分页 |
| 同步单个纳税人数据 | POST /sync | TaxpayerSyncParam(@Valid) | TaxpayerSyncResultDto | 按税号同步 |

**前端页面**:
- **纳税人列表页面** (`/taxpayer/list`): 列表+分页，行内"同步"按钮调用 `/sync`

### 3. 税率管理（TaxRateController）
**路径**: `/taxRate`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 从乐企平台同步税率信息 | POST /sync | 无 | Integer(同步条数) | 头部"同步"按钮 |
| 分页查询税率信息 | POST /list | TaxRateQueryParam | Page<TaxRateDto> | 分页 |
| 查询所有启用的税率列表 | POST /queryEnabled | 无 | List<TaxRateDto> | 用于下拉选择 |

**前端页面**:
- **税率列表页面** (`/taxrate/list`): 头部"同步"按钮+分页列表
- **下拉选择组件**: 使用 `/queryEnabled` 作为税率下拉数据源

### 4. 发票额度管理（InvoiceQuotaController）
**路径**: `/quota`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 查询发票额度 | POST /query | InvoiceQuotaQueryParam(@Valid) | InvoiceQuotaDto | |
| 下载发票额度 | POST /download | InvoiceQuotaOperationParam(@Valid) | InvoiceQuotaOperationResultDto | |
| 退回发票额度 | POST /return | InvoiceQuotaOperationParam(@Valid) | InvoiceQuotaOperationResultDto | |
| 调整发票额度有效期 | POST /adjustValidity | InvoiceQuotaValidityAdjustParam(@Valid) | InvoiceQuotaOperationResultDto | |
| 校验发票额度 | POST /validate | InvoiceQuotaValidationParam(@Valid) | InvoiceQuotaValidationDto | |

**前端页面**:
- **额度管理页面** (`/quota/list`): 列表+按钮（下载/退回/调整有效期/校验）

### 5. 预赋码管理（PreCodeController）
**路径**: `/preCode`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 申请预赋码号段 | POST /apply | PreCodeApplyParam(@Valid) | Boolean | |
| 预赋码分配 | POST /allocate | PreCodeAllocateParam(@Valid) | PreCodeAllocationDto | |
| 校验库存并自动申请 | POST /ensure | PreCodeEnsureParam(@Valid) | Boolean | |

**前端页面**:
- **开票向导 Step3**: 先调用 `/ensure` 校验，成功后调用 `/allocate` 分配，最后调用 `/add` 提交
- ** potentially 预赋码管理页面** (`/precode/list`): 如果需要单独管理预赋码

### 6. 发票汇总管理（InvoiceSummaryController）
**路径**: `/invoiceSummary`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 创建发票汇总信息 | POST /create | InvoiceSummaryCreateParam(@Valid) | InvoiceSummaryDto | |
| 分页查询发票汇总信息 | POST /list | InvoiceSummaryQueryParam(@Valid) | List<InvoiceSummaryDto> | 注意：返回List而非Page |

**前端页面**:
- **发票汇总页面** (`/summary/list`): 分页列表（虽然后端返回List，前端做分页）

### 7. 税收分类编码（TaxCatalogController）
**路径**: `/taxCatalog`

| 接口 | 路径 | 入参 | 出参 | 说明 |
|-----|------|------|------|------|
| 从乐企平台全量同步税收分类编码信息 | POST /sync | TaxCatalogSyncParam(@Valid) | Integer | 同步条数 |
| 分页查询税收分类编码信息 | POST /list | TaxCatalogQueryParam | Page<TaxCatalogDto> | |
| 根据编码查询税收分类编码信息 | POST /queryByCode | TaxCatalogQueryByCodeParam(@Valid) | TaxCatalogDto | |

**前端页面**:
- **税收分类编码列表页面** (`/taxcatalog/list`): 头部"同步"按钮+分页列表+搜索框（支持按编码查询）

---

## 菜单结构设计

```
主菜单（顶部导航）
├── 发票管理
│   ├── 发票列表（含新增表单）
│   ├── 上传管理
│   └── 下载管理
├── 基础数据
│   ├── 纳税人管理
│   ├── 税率管理
│   ├── 税收分类编码
│   └── 发票额度管理
└── 汇总管理
    └── 发票汇总
```

---

## 前端页面生成提示词

### 提示词模板1：新增发票表单页面

在发票列表页面中添加"新增发票"按钮，点击后弹出 Dialog 表单（`src/views/invoice/list.vue`），使用 Element UI 的 Form 组件：

**表单字段（与后端 DigitalInvoiceAddParam 一一对应）**:
- **发票基础信息**:
  - taxInvoiceNo（发票请求流水号，必填，字符串）
  - fppz（发票票种，必填，下拉：01-数电专，02-数电普）
  - lzfpbz（蓝字发票标志，必填，下拉：0-蓝字，1-红字）
- **销售方信息**:
  - xsfnsrsbh（销售方纳税人识别号，必填）
  - xsfmc（销售方名称，必填）
  - xsfdz（销售方地址，可选）
  - xsfdh（销售方电话，可选）
  - xsfkhh（销售方开户行，可选）
  - xsfzh（销售方账号，可选）
- **购买方信息**:
  - gmfnrsbh（购买方纳税人识别号，开具专票时必填）
  - gmfmc（购买方名称，必填）
  - gmfdz（购买方地址，可选）
  - gmfdh（购买方电话，可选）
  - gmfkhh（购买方开户行，可选）
  - gmfzh（购买方账号，可选）
- **开票人信息**:
  - kpr（开票人，必填）
  - kprq（开票日期，必填，日期时间选择器）
- **红字发票信息**（当 lzfpbz=1 时显示且必填）:
  - dylzfphm（对应蓝字发票号码）
  - hzqrxxdbh（红字确认信息单编号）
  - hzqrduuid（红字确认单UUID）
- **其他信息**:
  - bz（备注，可选）
  - skrxm（收款人姓名，可选）
  - fhrxm（复核人姓名，可选）
- **发票明细表（fpmxList，必填）**:
  - 列：mxxh（明细序号，必填，数字）、xmmc（项目名称，必填）、spfwjc（商品服务简称，必填）、ggxh（规格型号，可选）、dw（单位，可选）、sl（数量，字符串）、dj（单价，字符串）、je（金额，必填，decimal）、slv（增值税税率/征收率，必填，decimal）、se（税额，必填，decimal）、hsje（含税金额，必填，decimal）、sphfwssflhbbm（税收分类编码，必填）、fphxz（发票行性质，必填：00-正常行，01-折扣行，02-被折扣行）
  - 操作：新增行、删除行
  - 合计行：合计金额(hjje)、合计税额(hjse)、价税合计(jshj) - 自动计算，只读
  - 税率下拉：调用 `/taxRate/queryEnabled` 获取启用税率列表
- **附加要素列表（fjysList，可选）**:
  - fjysmc（附加要素名称）、fjyslx（附加要素类型）、fjysz（附加要素值）
- **差额扣除凭证列表（cekcList，可选）**:
  - xh（序号）、pzlx（凭证类型）、fpdm（发票代码）、fphm（发票号码）、cezphm（差额凭证号码）、kjrq（开具日期）、pzhjje（凭证合计金额）、bckcje（本次扣除金额）、bz（备注）

**提交逻辑**:
- 表单校验通过后，调用 `/digitalInvoice/add` 接口，传入完整的 DigitalInvoiceAddParam 对象
- 成功后关闭弹窗并刷新列表

**技术要点**:
- 使用 Vue 2.x Options API
- 金额字段使用 decimal.js 计算，类型为字符串
- 表单使用 Element UI 的 el-dialog + el-form
- 明细表使用 el-table 实现可编辑表格
- 日期使用 el-date-picker 日期时间选择器

---

### 提示词模板2-1：发票上传管理页面

请生成发票上传管理页面（`src/views/invoice/upload.vue`）:

**头部操作区**:
- 按钮："执行上传"（无需参数，直接调用 `/digitalInvoice/executeUpload`，返回已执行的任务ID列表）
- 按钮："查询上传结果"（弹出对话框）

**查询上传结果对话框（对应 sllsh 参数）**:
- sllsh（受理流水号，必填，字符串）

**表格**:
- 列：受理流水号(sllsh)、发票号码(fphm)、开票日期(kprq)、任务状态(status)、上传结果、错误信息
- 支持分页查询

**API调用**:
- 查询上传结果：调用 `/digitalInvoice/queryUploadResult`，入参 sllsh
- 执行上传：调用 `/digitalInvoice/executeUpload`，无需参数

---

### 提示词模板2-2：发票下载管理页面

请生成发票下载管理页面（`src/views/invoice/download.vue`）:

**头部操作区**:
- 按钮："申请下载"（弹出对话框）
- 按钮："执行待处理任务"（无需参数，直接调用 `/digitalInvoice/executePending`，返回执行任务数）

**申请下载对话框（对应 InvoiceDownloadApplyParam）**:
- nsrsbh（纳税人识别号，必填）
- kprqq（开票日期起，必填，格式：yyyyMMdd）
- kprqz（开票日期止，必填，格式：yyyyMMdd）
- fplx（发票类型，必填，下拉：82-电子发票普通发票，81-电子发票专用发票）
- sjlx（数据类型，必填，下拉：1-进项票，2-销项票）

**表格**:
- 列：下载任务ID、纳税人识别号(nsrsbh)、日期范围、发票类型(fplx)、数据类型(sjlx)、任务状态、下载结果、错误信息
- 支持分页查询

**API调用**:
- 申请下载：调用 `/digitalInvoice/apply`，入参 InvoiceDownloadApplyParam
- 执行待处理任务：调用 `/digitalInvoice/executePending`，无需参数

---

### 提示词模板2-3：发票列表页面

请生成发票列表页面（`src/views/invoice/list.vue`）:

**头部操作区**:
- 按钮："新增发票"（打开新增发票Dialog表单）

**查询表单区域**:
- 字段：发票号码(fphm)、销方税号(xsfnsrsbh)、购方税号(gmfnrsbh)、购买方名称(gmfmc)、开票日期范围(kprqStart, kprqEnd)、蓝红字标志(lzfpbz)
- 按钮：查询、重置、导出Excel

**表格区域**:
- 列：受理号(sllsh)、发票号码(fphm)、开票日期(kprq)、销方(xsfmc)、购方(gmfmc)、金额(je)、税额(se)、价税合计(jshj)、任务状态(status)
- 操作列：查看详情、下载PDF/附件

**分页组件**:
- 使用 Element UI el-table 的 pagination
- 策略：首次查询返回 total，翻页时传递 `total=-1` 不再查询总数（需自定义 pagination 的 @current-change 事件）

**API调用**:
- 使用 `/digitalInvoice/list` 接口，入参 `DigitalInvoiceQueryParam`

---

### 提示词模板4：纳税人列表页面


请生成纳税人列表页面（`src/views/taxpayer/list.vue`）:

**头部操作区**:
- 按钮："批量同步"（弹出对话框，输入纳税人识别号列表）

**查询表单**:
- 字段：纳税人识别号(nsrsbh)、纳税人名称(nsrmc)、日期范围
- 按钮：查询、重置、导出

**表格**:
- 列：税号(nsrsbh)、名称(nsrmc)、行业代码(hydm)、有效期(yxqq~yxqz)、状态、操作
- 操作列：每行"同步"按钮（弹出对话框）

**同步对话框（对应 TaxpayerSyncParam）**:
- nsrsbh（纳税人识别号，必填，15-20位）

**分页**:
- 使用 `/taxpayer/list` 接口，返回 `Page<TaxpayerDto>`

---

### 提示词模板5：税率列表页面

请生成税率列表页面（`src/views/taxrate/list.vue`）:

**头部操作区**:
- 按钮："同步"（无需参数，直接调用 `/taxRate/sync`，显示同步条数）

**查询表单**:
- 字段：税率名称关键词、是否启用
- 按钮：查询、重置

**表格**:
- 列：税率(rate)、名称(name)、启用状态(enabled)
- 注意：启用状态显示开关图标（如 FontAwesome 的 toggle-on/toggle-off）

**分页**:
- 使用 `/taxRate/list` 接口

---

### 提示词模板6：额度管理页面

请生成发票额度管理页面（`src/views/quota/list.vue`）:

**头部操作区**:
- 按钮："查询额度"（弹出对话框）

**查询额度对话框（对应 InvoiceQuotaQueryParam）**:
- nsrsbh（纳税人识别号，必填，15-20位）

**表格**:
- 列：税号、票种、额度、阈值、有效期、状态、操作
- 操作列：下载、退回、调整有效期、校验

**下载额度对话框（对应 InvoiceQuotaOperationParam）**:
- nsrsbh（纳税人识别号，必填）
- sqlx（申请类型，必填，下拉：0-下载，1-退回）
- sqed（申请额度，必填，decimal，>0.01）
- ywlsh（业务流水号，可选）

**退回额度对话框（对应 InvoiceQuotaOperationParam）**:
- 同下载对话框

**调整有效期对话框（对应 InvoiceQuotaValidityAdjustParam）**:
- xsfnsrsbh（销售方纳税人识别号，必填，15-20位）
- sxedsq（发票额度属期，必填，格式：yyyyMM）

**校验额度对话框（对应 InvoiceQuotaValidationParam）**:
- nsrsbh（纳税人识别号，必填，15-20位）
- invoiceAmount（发票金额，必填，decimal，>0.01）
- kprq（开票日期，必填，日期字符串）

---

### 提示词模板7：发票汇总页面

请生成发票汇总页面（`src/views/summary/list.vue`）:

**注意**: 后端返回 `List<InvoiceSummaryDto>` 而非 `Page`，需要前端自己实现分页

**查询表单**:
- 字段：销方税号、月份(月份选择器)、类型（确认/取消）

**表格**:
- 列：月份(yf)、蓝字发票数量/金额/税额、红字发票数量/金额/税额、上传状态(uploadStatus)、操作
- 操作列：详情按钮

**头部按钮**:
- "上传汇总"按钮（调用 `/invoiceSummary/create`）

---

### 提示词模板8：税收分类编码列表页面

请生成税收分类编码列表页面（`src/views/taxcatalog/list.vue`）:

**头部操作区**:
- 按钮："同步"（弹出对话框）

**同步对话框（对应 TaxCatalogSyncParam）**:
- nsrsbh（纳税人识别号，必填，15-20位）

**查询表单**:
- 字段：编码关键词、名称关键词
- 按钮：查询、重置

**表格**:
- 列：编码(sphfwssflhbbm)、名称(sphfssmc)、税率(sls)、说明、操作
- 操作列：查看详情按钮（弹出对话框）

**查看详情对话框（对应 TaxCatalogQueryByCodeParam）**:
- nsrsbh（纳税人识别号，必填）
- sphfwssflhbbm（税收分类编码，必填）

---

## 前端项目技术栈与配置

### 技术栈
- Vue 2.0 + Vue CLI / Vite (JavaScript)
- Element UI (PC端UI组件库)
- Vant 2.x (移动端UI组件库)
- Vue Router 3.x
- Vuex (状态管理)
- axios (HTTP客户端)
- dayjs (日期处理)
- decimal.js (金额计算)

### 关键配置

#### 1. Vite 代理配置（vite.config.js）
```javascript
export default {
  server: {
    proxy: {
      '/lqadapter': {
        target: 'http://localhost:9057',
        changeOrigin: true,
      }
    }
  }
}
```

#### 2. API 客户端配置（src/api/request.js）
- baseURL: "/lqadapter"
- 所有请求使用 POST 方法
- 统一返回格式：ResultInfo<T>，axios拦截器做错误处理
- 使用 axios 实例创建 request 工具

#### 3. 分页策略
- 首页查询时传递正常分页参数
- 翻页时传递 `total: -1` 不再查询总数

#### 4. 日期与金额
- 日期：后端时间戳，前端用 dayjs 格式化显示，使用 Locale zh-cn
- 金额：使用 decimal.js 计算，字段为 string，小数位最多2位

---

## 项目目录结构

```
src/
├── api/                  # API接口封装
│   ├── request.ts       # axios实例
│   ├── client.ts        # 统一请求方法
│   └── modules/         # 各模块接口
│       ├── invoice.ts
│       ├── taxpayer.ts
│       └── ...
├── views/               # 页面组件 (Vue文件)
│   ├── invoice/        # 发票相关页面
│   ├── taxpayer/       # 纳税人相关页面
│   └── ...
├── components/         # 公共组件
├── store/             # Vuex状态管理
├── types/             # JavaScript类型定义（JSDoc注释）
├── utils/             # 工具函数
├── router/            # 路由配置
├── App.vue           # 根组件
└── main.js           # 入口文件
```

## DTO 类型定义（JavaScript + JSDoc）

请生成以下 JavaScript 类型定义（使用 JSDoc 注释，`src/types/index.js`）:

```javascript
/**
 * 通用返回类型
 * @template T
 * @typedef {Object} ResultInfo
 * @property {string} [code] - 错误码
 * @property {string} [msg] - 错误信息
 * @property {T|null} data - 返回数据
 */

/**
 * 分页类型
 * @template T
 * @typedef {Object} Page
 * @property {Array<T>} list - 数据列表
 * @property {number} total - 总数
 */

/**
 * @typedef {Object} TaxpayerQueryParam
 * @property {number} [pageNum] - 页码
 * @property {number} [pageSize] - 每页大小
 * @property {string} [nsrsbh] - 纳税人识别号
 * @property {string} [nsrmc] - 纳税人名称
 */

/**
 * @typedef {Object} TaxpayerSyncParam
 * @property {string} nsrsbh - 纳税人识别号
 */

/**
 * @typedef {Object} DigitalInvoiceAddParam
 * @property {string} taxInvoiceNo - 发票请求流水号（幂等键）
 * @property {string} fppz - 发票票种（01-数电专，02-数电普）
 * @property {string} lzfpbz - 蓝字发票标志（0-蓝字，1-红字）
 * @property {string} xsfnsrsbh - 销售方纳税人识别号
 * @property {string} xsfmc - 销售方名称
 * @property {string} [xsfdz] - 销售方地址
 * @property {string} [xsfdh] - 销售方电话
 * @property {string} [xsfkhh] - 销售方开户行
 * @property {string} [xsfzh] - 销售方账号
 * @property {string} [gmfnrsbh] - 购买方纳税人识别号（开具专票时必填）
 * @property {string} gmfmc - 购买方名称
 * @property {string} [gmfdz] - 购买方地址
 * @property {string} [gmfdh] - 购买方电话
 * @property {string} [gmfkhh] - 购买方开户行
 * @property {string} [gmfzh] - 购买方账号
 * @property {string} kpr - 开票人
 * @property {string} kprq - 开票日期（yyyy-MM-dd HH:mm:ss）
 * @property {number} hjje - 合计金额
 * @property {number} hjse - 合计税额
 * @property {number} jshj - 价税合计
 * @property {string} [dylzfphm] - 对应蓝字发票号码（红票必填）
 * @property {string} [hzqrxxdbh] - 红字确认信息单编号（红票必填）
 * @property {string} [hzqrduuid] - 红字确认单UUID（红票必填）
 * @property {string} [bz] - 备注
 * @property {string} [skrxm] - 收款人姓名
 * @property {string} [fhrxm] - 复核人姓名
 * @property {Array<InvoiceDetailParam>} fpmxList - 发票明细列表
 * @property {Array<AdditionalElementParam>} [fjysList] - 附加要素列表
 * @property {Array<VoucherParam>} [cekcList] - 差额扣除凭证列表
 */

/**
 * @typedef {Object} InvoiceDetailParam
 * @property {number} mxxh - 明细序号
 * @property {string} xmmc - 项目名称
 * @property {string} spfwjc - 商品服务简称
 * @property {string} [ggxh] - 规格型号
 * @property {string} [dw] - 单位
 * @property {string} [sl] - 数量
 * @property {string} [dj] - 单价
 * @property {number} je - 金额
 * @property {number} slv - 增值税税率/征收率
 * @property {number} se - 税额
 * @property {number} hsje - 含税金额
 * @property {string} sphfwssflhbbm - 税收分类编码
 * @property {'00'|'01'|'02'} fphxz - 发票行性质（00-正常行，01-折扣行，02-被折扣行）
 * @property {string} [yhzcbs] - 优惠政策标识
 */

/**
 * @typedef {Object} InvoiceQuotaQueryParam
 * @property {string} nsrsbh - 纳税人识别号（15-20位）
 */

/**
 * @typedef {Object} InvoiceQuotaOperationParam
 * @property {string} nsrsbh - 纳税人识别号（15-20位）
 * @property {string} sqlx - 申请类型（0-下载，1-退回）
 * @property {number} sqed - 申请额度（必须大于0.01）
 * @property {string} [ywlsh] - 业务流水号（可选，用于重试）
 */

/**
 * @typedef {Object} InvoiceQuotaValidityAdjustParam
 * @property {string} xsfnsrsbh - 销售方纳税人识别号（15-20位）
 * @property {string} sxedsq - 发票额度属期（格式：yyyyMM）
 */

/**
 * @typedef {Object} InvoiceQuotaValidationParam
 * @property {string} nsrsbh - 纳税人识别号（15-20位）
 * @property {number} invoiceAmount - 发票金额（必须大于0.01）
 * @property {string} kprq - 开票日期
 */

/**
 * @typedef {Object} InvoiceDownloadApplyParam
 * @property {string} nsrsbh - 纳税人识别号
 * @property {string} kprqq - 开票日期起（格式：yyyyMMdd）
 * @property {string} kprqz - 开票日期止（格式：yyyyMMdd）
 * @property {string} fplx - 发票类型（82-电子发票普通发票，81-电子发票专用发票）
 * @property {string} sjlx - 数据类型（1-进项票，2-销项票）
 */

/**
 * @typedef {Object} TaxCatalogSyncParam
 * @property {string} nsrsbh - 纳税人识别号（15-20位）
 */

// ... 更多类型定义
```

---

## Vue 2 组件使用说明

### Element UI 常用组件
- **el-form**: 表单容器，使用 `:model` 绑定数据，`:rules` 绑定校验规则
- **el-form-item**: 表单项，使用 `prop` 指定字段名，嵌套输入组件
- **el-input**: 输入框，使用 `v-model` 双向绑定
- **el-select**: 下拉选择，使用 `v-model` 绑定值
- **el-table**: 表格，使用 `:data` 绑定数据源
- **el-pagination**: 分页，监听 `@current-change` 事件处理翻页
- **el-button**: 按钮，使用 `@click` 绑定点击事件
- **el-steps**: 步骤条，用于向导流程

### Vue 2 Options API
```vue
<template>
  <el-form :model="form" :rules="rules" ref="formRef">
    <el-form-item label="税号" prop="nsrsbh">
      <el-input v-model="form.nsrsbh" />
    </el-form-item>
    <el-button @click="submit">提交</el-button>
  </el-form>
</template>

<script>
export default {
  data() {
    return {
      form: {
        nsrsbh: ''
      },
      rules: {
        nsrsbh: [
          { required: true, message: '税号不能为空', trigger: 'blur' },
          { pattern: /^[0-9A-Z]{15,18}$/, message: '税号格式不正确', trigger: 'blur' }
        ]
      }
    }
  },
  methods: {
    async submit() {
      await this.$refs.formRef.validate()
      // 提交逻辑
    }
  }
}
</script>
```

### Vuex 状态管理
```javascript
// store/modules/user.js
const state = {
  currentTaxpayer: null
}

const mutations = {
  SET_CURRENT_TAXPAYER(state, payload) {
    state.currentTaxpayer = payload
  }
}

const actions = {
  async syncTaxpayer({ commit }, nsrsbh) {
    const result = await syncTaxpayerApi(nsrsbh)
    commit('SET_CURRENT_TAXPAYER', result.data)
  }
}

export default {
  namespaced: true,
  state,
  mutations,
  actions
}

// 在组件中使用
export default {
  methods: {
    async handleSync() {
      await this.$store.dispatch('user/syncTaxpayer', '91110000XXXXXXXA')
    }
  }
}
```

### Vue Router 3.x 路由配置
```javascript
// router/index.js
import Vue from 'vue'
import VueRouter from 'vue-router'

Vue.use(VueRouter)

const routes = [
  {
    path: '/invoice',
    component: () => import('@/layouts/MainLayout.vue'),
    children: [
      {
        path: 'wizard',
        name: 'InvoiceWizard',
        component: () => import('@/views/invoice/wizard.vue')
      },
      {
        path: 'list',
        name: 'InvoiceList',
        component: () => import('@/views/invoice/list.vue')
      }
    ]
  }
]

const router = new VueRouter({
  mode: 'history',
  base: '/lqadapter/',
  routes
})

export default router
```

## 总结

以上是基于后端 Controller 完整提取的前端开发提示词（Vue 2.0 + Element UI + Vant），可直接用于：
1. 生成前端项目骨架
2. 生成API模块封装
3. 生成Vue页面组件
4. 生成菜单和路由配置
5. 与后端联调

**关键提醒**:
- 所有接口仅使用 POST 方法
- 分页策略：首页查总数，翻页 `total=-1`
- 金额使用 decimal.js，字段为 string
- 日期使用时间戳，前端 dayjs 格式化显示
- 使用 Vue 2.x Options API
- Element UI 用于 PC 端，Vant 2.x 用于移动端

